# Aura Helper Ignore Module
Module to ignore metadata from your salesforce projects or from a JSON metadata object. This module will be specially util in some use cases, like Custom Label values unique for every environment (like ids...), or to avoid deploy some user permissions, or when you creating autogenerated package (from git for example) and like to excludo some metadata automatically. To understund the .ahignore.json file, see [Ignore File](#ignore-file) section.

This module is used to [@ah/package-generator](https://github.com/JJLongoria/aura-helper-package-generator) for ignore metadata types when created the package or detructive XML files.

# [Usage](#usage)

## [Ignore Metadata from JSON Metadata Object](#ignore-json-metadata)
You can ignore metadata from a JSON Metadata Object (the JSON used in [@ah/package-generator](https://github.com/JJLongoria/aura-helper-package-generator) to created the package XML files) with a simple method.


### **Ignore Metadata from Metadata JSON Object**
    const Ignore = require('@ah/ignore');

    // Uncheck elements from Metadata JSON Object to avoid put in package XML Files
    let result = Ignore.ignoreMetadata('path/to/json/file', './path/to/ignore/file');

    console.log(result);    // Return a JSON Metadata Object with ignored metadata unchecked for exclude when created the pacakges XML files

***

### **Ignore Specified Metadata from Metadata JSON Object**
    const Ignore = require('@ah/ignore');

    // Uncheck specified metadata elements from Metadata JSON Object to avoid put in package XML Files
    const typesForIgnore = ['CustomObject'];    // Optional parameter to ignore metadata. This parameter is used to ignore only the specified metadata on it (also must 
                                                // be in ignore file) and avoid ignore all metadata types specified on the file. For example, you have an ignore file
                                                // with CustomObjects, CustomFields and CustomLabels and you only need to ignore the CustomObjects.

    let result = Ignore.ignoreMetadata('path/to/json/file', './path/to/ignore/file', typesForIgnore);
    
    console.log(result);    // Return a JSON Metadata Object with ignored metadata unchecked for exclude when created the pacakges XML files

***

### **Ignore Metadata and Remove from Metadata JSON Object**
    const Ignore = require('@ah/ignore');

    // Remove elements from Metadata JSON Object to avoid put in package XML Files
    const remove = true;
    let result = Ignore.ignoreMetadata('path/to/json/file', './path/to/ignore/file', undefined, remove);

    console.log(result);    // Return a JSON Metadata Object with ignored metadata removed from thhe object for exclude when created the pacakges XML files

***

## [Ignore Metadata from Project](#ignore-project-metadata)
Ignore Metadata from your Salesforce Project. This option can remove entire file or folders from your project, or remove some metadata into your files like some custom labels from the custom labels file, or workflow alerts from your Account workflow file for example. For this operation, also need a Metadata Details from your salesforce project. You can get it with [@ah/connector](https://github.com/JJLongoria/aura-helper-connector) from your org using the listMetadataTypes() method. Also allow to you to compress files with the [@ah/xml-compressor](https://github.com/JJLongoria/aura-helper-xml-compressor)

    const Ignore = require('@ah/ignore');
    const Connection = require('@ah/connector');
    const { SORT_ORDER } = require('@ah/xml-compressor');
    
    // Get Metadata Details from your org using @ah/connector
    const connection = new Connection('MyOrg', '50');
    connection.setUsernameOrAlias('MyOrg');
    connection.setSingleThread();
    connection.listMetadataTypes().then((metadataDetails) => {
        Ignore.ignoreProjectMetadata('path/to/your/project', metadataDetails, './path/to/ignore/file');

        // Like on Ignore Metadata method, you can choose an optional metadata types for ignore
        const options = {
            typesForIgnore:  ['CustomObject', 'CustomField', 'ApexClass'],
        }
        Ignore.ignoreProjectMetadata('path/to/your/project', metadataDetails, './path/to/ignore/file', options);

        // Also you can choose to compress the modified files with @ah/xml-compressor
        const options = {
            typesForIgnore:  ['CustomObject', 'CustomField', 'ApexClass'],
            compress: true,
            sortOrder: SORT_ORDER.SIMPLE_FIRST      // Yoy can choose a sort order for compression
        }
        Ignore.ignoreProjectMetadata('path/to/your/project', metadataDetails, './path/to/ignore/file', options);
    }).catch((error) => {
        
    });

# [Ignore File](#ignore-file)

The ignore file is a JSON file used on ignore, create package or repair dependencies modules. On this file you can specify metadata types, objects and elements for ignore or delete from your local project or package files. You can have a main ignore file on your root project (like gitignore) named .ahignore.json for use automatically, or have different ignore files and specify it on the commands when you need tou use.

The ignore file have the next structure

    {
        // Basic structure
        "MetadataTypeAPIName": {
            "MetadataObject1",
            "MetadataObject2"
        }

        // Advance Structure
        "MetadataTypeAPIName": {
            "MetadataObject1:MetadataItem1",
            "MetadataObject1:MetadataItem2",
            "MetadataObject2:*",
            "*",
            "*:*" // Only valid on Custom Objects
        }

        // Special for Permissions
        "MetadataTypeAPIName": {
            "UserPermission:MetadataObject1:PermissionName",
            "UserPermission:MetadataObject2:*",
            "UserPermission:*:PermissionName"
        }
    }

*Example*:

    {
        "CustomLabels": {
            "labelName1",                   // Ignore or remove the custom label "labelName1"
            "labelName2",                   // Ignore or remove the custom label "labelName2",
            "*"                             // Ignore or remove all Custom Labels
        },
        "AssignmentRules":{
            "Case:Assign1",                 // Ignore or remove the Assignent Rule "Assign1" from the object Case
            "Lead:*",                       // Ignore or remove all Assignment Rules from Lead
            "*"                             // Ignore or remove all Assignment Rules
        },
        "CustomObject": {
            "Account",                      // Ignore or remove the Account Object
            "Case:*",                       // Ignore or remove all related objects from case, including the object (Bussines Process, Fields, Validation Rules...),
            "*",                            // Ignore or remove all custom objects (only the object not the related metadata)
            "*:*",                          // Ignore or remove all custom objects and the related metadata (Bussines Process, Fields, Validation Rules...)
        },
        "Report": {
            "ReportFolder",                 // Ignore or remove the entire folder
            "ReportFolder1:ReportName2",    // Ignore or remove the report "ReportName2" from "ReportFolder1" folder.
            "*",                            // Ignore or remove all reports.
        },
        "Workflow": {
            "Account",                      // Ignore or remove the Account worflows (Rules, Task, Alerts...)
            "*"                             // Ignore or  remove all workflows (Rules, Task, Alerts...) from all objects 
        },
        "WorkflowRule": {
            "Case:*",                       // Ignore or remove all Workflow rules from case object
            "Account:Rule1",                // Ignore or remove "Rule1" from Account workflows,
            "*"                             // Ignore or remove all Worflow rules from all objects
        },
        "Profile": {
            "UserPermission:*:Permission1", // Remove the "Permission1" User Permission from all profiles
            "UserPermission:TestProfile:*", // Remove all User permissions from TestProfile file
            "UserPermission:Admin:Perm1",   // Remove the Perm1 User Permission from Admin profile
            "TestProfile2",                 // Ignore or remove  the "TestProfile" profile 
            "*"                             // Ignore or remove all profiles
        }
    }

#### IMPORTANT

    Some Metadata Types have singular and plural name like CustomLabels, MatchingRules, EscalationRules... For ignore or remove this types you must use the plural name, if use the singular name the ignore process not take effect with this types.