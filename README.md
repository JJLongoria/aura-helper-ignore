# **Aura Helper Ignore Module**
Module to ignore metadata from your salesforce projects or from a JSON metadata object. This module will be specially util in some use cases, like Custom Label values unique for every environment (like ids...), or to avoid deploy some user permissions, or when you creating autogenerated package (from git for example) and like to excludo some metadata automatically. To understund the .ahignore.json file, see [Ignore File](#ignore-file) section.

This module is used to [@ah/package-generator](https://github.com/JJLongoria/aura-helper-package-generator) for ignore metadata types when created the package or detructive XML files.

---

## *Table of Contents*

- [**Ignore Class**](#ignore-class)

- [**Metadata JSON Format**](#metadata-json-format)
  
- [**Ignore File**](#ignore-file)

---

# [**Ignore Class**](#ignore-class)
Class to ignore metadata from your salesforce projects or from a JSON metadata object. 

# [**Methods**](#ignore-class-methods)

  - [**ignoreMetadata(metadataOrPath, ignorefile, typesToIgnore, remove, progressCallback)**](#ignoremetadatametadataorpath-ignorefile-typestoignore-remove-progresscallback)

    Method to ignore Metadata types from a Metadata JSON Object or Metadata JSON file. You can choose to uncheck elements or remove it from Metadata JSON.

  - [**ignoreProjectMetadata(projectPath, metadataDetails, ignorefile, options, progressCallback)**](#ignoreprojectmetadataprojectpath-metadatadetails-ignorefile-options-progresscallback)

    Method to ignore Metadata types from your local project. This method can delete some data from XML Files or entire XML files or folders according the ignore file data

---
## [**ignoreMetadata(metadataOrPath, ignorefile, typesToIgnore, remove, progressCallback)**](#ignoremetadatametadataorpath-ignorefile-typestoignore-remove-progresscallback)
Method to ignore Metadata types from a Metadata JSON Object or Metadata JSON file. You can choose to uncheck elements or remove it from Metadata JSON. See [Metadata JSON Format](#metadata-file) section to understand the JSON Metadata Format 

### **Parameters:**
  - **metadataOrPath**: Metadata JSON Object or Metadata JSON file path
    - String | Object
  - **ignorefile**: Path to the ignore file
    - String
  - **typesToIgnore**: Parameter to ignore metadata. This parameter is used to ignore only the specified metadata (also must be in ignore file) and avoid ignore all metadata types specified on the file.
    - Object
  - **remove**: True to remove ignored elements from the result object, false only for unselect elements 
    - Boolean
  - **progressCallback**: Function to handle the ignore progress status
    - Function

### **Return:**
Return a Metadata JSON Object with the ignored metadata unselected or removed
- Object

### **Throws:**
This method can throw the next exceptions:

- **WrongFilePathException**: If the metadata file path or ignore file path is not a String or can't convert to absolute path
- **FileNotFoundException**: If the metadata file path or ignore file not exists or not have access to it
- **InvalidFilePathException**: If the metadata file path or ignore file is not a file
- **WrongFormatException**: If metadata file path or ignore file is not a JSON file or Metadata Object are wrong

### **Examples:**
**Ignore Metadata from Metadata JSON Object**

    const Ignore = require('@ah/ignore');
    const metadataObjects = {
        CustomObject: {
            name: 'CustomObject',
            childs: {
                Account: {
                    name: 'Account',
                    checked: true,
                    childs: {}
                }
            },
            checked: true,
        },
        CustomField: {
            name: 'CustomField',
            childs: {
                Account: {
                    name: 'Account',
                    checked: true,
                    childs: {
                        Name: {
                            name: 'Name',
                            checked: true
                        }
                    }
                }
            },
            checked: true,
        },
        {
            ...
        }
    }
    const ignoreFile = './path/to/ignore/file';
    const metadataTypes = Ignore.ignoreMetadata(metadataObjects, ignoreFile);

    console.log(metadataTypes);

**Ignore Specified Metadata from Metadata JSON File**

    const Ignore = require('@ah/ignore');

    const typesForIgnore = ['CustomObject'];
    const metadataPath = 'path/to/json/file';
    const ignoreFile = './path/to/ignore/file';
    const metadataTypes = Ignore.ignoreMetadata(metadataPath, ignoreFile, typesForIgnore);
    
    console.log(metadataTypes); 

**Ignore Metadata and Remove from Metadata JSON File**

    const Ignore = require('@ah/ignore');

    const remove = true;
    const metadataPath = 'path/to/json/file';
    const ignoreFile = './path/to/ignore/file';
    const metadataTypes = Ignore.ignoreMetadata(metadataPath, ignoreFile, undefined, remove);

    console.log(metadataTypes);
---

## [**ignoreProjectMetadata(projectPath, metadataDetails, ignorefile, options, progressCallback)**](#ignoreprojectmetadataprojectpath-metadatadetails-ignorefile-options-progresscallback)
Method to ignore Metadata types from your local project. This method can delete some data from XML Files or entire XML files or folders according the ignore file data

### **Parameters:**
  - **projectPath**: Salesforce Project root path
    - String
  - **metadataDetails**: Metadata details list
    - Array\<MetadataDetail\>
  - **ignorefile**: Path to the ignore file
    - String
  - **options**: Options object to choose if compress modified files, compression order and specify types to ignore 
    - Object
  - **progressCallback**: Function to handle the ignore progress status
    - Function

### **Throws:**
This method can throw the next exceptions:

- **WrongFilePathException**: If the ignore file path is not a String or can't convert to absolute path
- **FileNotFoundException**: If the ignore file not exists or not have access to it
- **InvalidFilePathException**: If the ignore file is not a file
- **WrongFormatException**: If ignore file is not a JSON file
- **WrongDirectoryPathException**: If the project path is not a String or can't convert to absolute path
- **DirectoryNotFoundException**: If the project path directory not exists or not have access to it
- **InvalidDirectoryPathException**: If the project path is not a directory

### **Examples:**
**Ignore Metadata from Project**

This option can remove entire file or folders from your project, or remove some metadata into your files like some custom labels from the custom labels file, or workflow alerts from your Account workflow file for example. For this operation, also need a Metadata Details from your salesforce project. You can get it with [@ah/connector](https://github.com/JJLongoria/aura-helper-connector) from your org using the listMetadataTypes() method. Also allow to you to compress files with the [@ah/xml-compressor](https://github.com/JJLongoria/aura-helper-xml-compressor)

    const Ignore = require('@ah/ignore');
    const Connection = require('@ah/connector');
    const { SORT_ORDER } = require('@ah/xml-compressor');
    
    // Get Metadata Details from your org using @ah/connector
    const connection = new Connection('MyOrg', '50');
    connection.setUsernameOrAlias('MyOrg');
    connection.setSingleThread();
    connection.listMetadataTypes().then((metadataDetails) => {
        Ignore.ignoreProjectMetadata('path/to/your/project', metadataDetails, './path/to/ignore/file');

        // Like on Ignore Metadata method, you can choose an optional metadata types for ignore
        const options = {
            typesForIgnore:  ['CustomObject', 'CustomField', 'ApexClass'],
        }
        Ignore.ignoreProjectMetadata('path/to/your/project', metadataDetails, './path/to/ignore/file', options);

        // Also you can choose to compress the modified files with @ah/xml-compressor
        const options = {
            typesToIgnore:  ['CustomObject', 'CustomField', 'ApexClass'],
            compress: true,
            sortOrder: SORT_ORDER.SIMPLE_FIRST      // Yoy can choose a sort order for compression
        }

        const rootProjectPath = 'path/to/your/project';
        const ignoreFile = './path/to/ignore/file';
        Ignore.ignoreProjectMetadata(rootProjectPath, metadataDetails, ignoreFile, options);
    }).catch((error) => {
        // Handle errors
    });

# [**Metadata JSON Format**](#metadata-file)

The Metadata JSON Format used by Aura Helper Framework and modules have the next structure. Some fields are required and the datatypes checked to ensure the correct file structure. 

    {
        "MetadataAPIName": {
            "name": "MetadataAPIName",                                  // Required (String). Contains the Metadata Type API Name (like object Key)
            "checked": false,                                           // Required (Boolean). Field for include this type on package or not
            "path": "path/to/the/metadata/folder",                      // Optional (String). Path to the Metadata Type folder in local project
            "suffix": "fileSuffix",                                     // Optional (String). Metadata File suffix
            "childs": {                                                 // Object with a collection of childs (Field required (JSON Object) but can be an empty object)
                "MetadataObjectName":{
                    "name": "MetadataObjectName",                       // Required (String). Contains the Metadata Object API Name (like object Key)
                    "checked": false,                                   // Required (Boolean). Field for include this object on package or not
                    "path": "path/to/the/metadata/file/or/folder",      // Optional (String). Path to the object file or folder path
                    "childs": {                                         // Object with a collection of childs (Field required (JSON Object) but can be an empty object)
                        "MetadataItemName": {
                            "name": "MetadataItemName",                 // Required (String). Contains the Metadata Item API Name (like object Key)
                            "checked": false,                           // Required (Boolean). Field for include this object on package or not
                            "path": "path/to/the/metadata/file"
                        },
                        "MetadataItemName2": {
                            ...
                        },
                        ...,
                        ...,
                        ...
                    }
                }
                "MetadataObjectName2":{
                   ...
                },
                ...,
                ...,
                ...
            }
        }
    }

### **Example**:

***
    {
        "CustomObject": {
            "name": "CustomObject",
            "checked": false,
            "path":  "path/to/root/project/force-app/main/default/objects",
            "suffix": "object",
            "childs": {
                "Account": {
                    "name": "Account",
                    "checked": true,            // Add Account Object to the package
                    "path": "path/to/root/project/force-app/main/default/objects/Account/Account.object-meta.xml",
                    "childs": {}
                },
                "Case": {
                    "name": "Case",
                    "checked": true,            // Add Case Object to the package
                    "path": "path/to/root/project/force-app/main/default/objects/Case/Case.object-meta.xml",
                    "childs": {}
                },
                ...,
                ...,
                ...
            }
        },
        "CustomField": {
            "name": "CustomField",
            "checked": false,
            "path":  "path/to/root/project/force-app/main/default/objects",
            "suffix": "field",
            "childs": {
                "Account": {
                    "name": "Account",
                    "checked": false,            
                    "path": "path/to/root/project/force-app/main/default/objects/Account/fields",
                    "childs": {
                        "customField__c": {
                            "name": "customField__c",
                            "checked": true,    // Add customField__c to the package
                            "path": "path/to/root/project/force-app/main/default/objects/Account/fields/customField__c.field-meta.xml",
                        },
                        ...,
                        ...,
                        ...
                    }
                },
                "Case": {
                    "name": "Case",
                    "checked": false,           
                    "path": "path/to/root/project/force-app/main/default/objects/Case/fields",
                    "childs": {
                        "CaseNumber": {
                            "name": "CaseNumber",
                            "checked": true,    // Add CaseNumber to the package
                            "path": "path/to/root/project/force-app/main/default/objects/Account/fields/CaseNumber.field-meta.xml",
                        },
                        ...,
                        ...,
                        ...
                    }
                },
                ...,
                ...,
                ...
            }
        }
    }


# [Ignore File](#ignore-file)

The ignore file is a JSON file used on ignore, create package or repair dependencies modules. On this file you can specify metadata types, objects and elements for ignore or delete from your local project or package files. You can have a main ignore file on your root project (like gitignore) named .ahignore.json for use automatically, or have different ignore files and specify it on the commands when you need tou use.

The ignore file have the next structure

    {
        // Basic structure
        "MetadataTypeAPIName": {
            "MetadataObject1",
            "MetadataObject2"
        }

        // Advance Structure
        "MetadataTypeAPIName": {
            "MetadataObject1:MetadataItem1",
            "MetadataObject1:MetadataItem2",
            "MetadataObject2:*",
            "*",
            "*:*" // Only valid on Custom Objects
        }

        // Special for Permissions
        "MetadataTypeAPIName": {
            "UserPermission:MetadataObject1:PermissionName",
            "UserPermission:MetadataObject2:*",
            "UserPermission:*:PermissionName"
        }
    }

*Example*:

    {
        "CustomLabels": {
            "labelName1",                   // Ignore or remove the custom label "labelName1"
            "labelName2",                   // Ignore or remove the custom label "labelName2",
            "*"                             // Ignore or remove all Custom Labels
        },
        "AssignmentRules":{
            "Case:Assign1",                 // Ignore or remove the Assignent Rule "Assign1" from the object Case
            "Lead:*",                       // Ignore or remove all Assignment Rules from Lead
            "*"                             // Ignore or remove all Assignment Rules
        },
        "CustomObject": {
            "Account",                      // Ignore or remove the Account Object
            "Case:*",                       // Ignore or remove all related objects from case, including the object (Bussines Process, Fields, Validation Rules...),
            "*",                            // Ignore or remove all custom objects (only the object not the related metadata)
            "*:*",                          // Ignore or remove all custom objects and the related metadata (Bussines Process, Fields, Validation Rules...)
        },
        "Report": {
            "ReportFolder",                 // Ignore or remove the entire folder
            "ReportFolder1:ReportName2",    // Ignore or remove the report "ReportName2" from "ReportFolder1" folder.
            "*",                            // Ignore or remove all reports.
        },
        "Workflow": {
            "Account",                      // Ignore or remove the Account worflows (Rules, Task, Alerts...)
            "*"                             // Ignore or  remove all workflows (Rules, Task, Alerts...) from all objects 
        },
        "WorkflowRule": {
            "Case:*",                       // Ignore or remove all Workflow rules from case object
            "Account:Rule1",                // Ignore or remove "Rule1" from Account workflows,
            "*"                             // Ignore or remove all Worflow rules from all objects
        },
        "Profile": {
            "UserPermission:*:Permission1", // Remove the "Permission1" User Permission from all profiles
            "UserPermission:TestProfile:*", // Remove all User permissions from TestProfile file
            "UserPermission:Admin:Perm1",   // Remove the Perm1 User Permission from Admin profile
            "TestProfile2",                 // Ignore or remove  the "TestProfile" profile 
            "*"                             // Ignore or remove all profiles
        }
    }

#### IMPORTANT

    Some Metadata Types have singular and plural name like CustomLabels, MatchingRules, EscalationRules... For ignore or remove this types you must use the plural name, if use the singular name the ignore process not take effect with this types.